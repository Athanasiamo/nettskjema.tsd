<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nettskjema.tsd">
<title>Using nettskjema.tsd in TSD • nettskjema.tsd</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using nettskjema.tsd in TSD">
<meta property="og:description" content="nettskjema.tsd">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nettskjema.tsd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/nettskjematsd.html">Using nettskjema.tsd in TSD</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/LCBC-UiO/nettskjema.tsd/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using nettskjema.tsd in TSD</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LCBC-UiO/nettskjema.tsd/blob/HEAD/vignettes/nettskjematsd.Rmd" class="external-link"><code>vignettes/nettskjematsd.Rmd</code></a></small>
      <div class="d-none name"><code>nettskjematsd.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/nettskjema.tsd" class="external-link">nettskjema.tsd</a></span><span class="op">)</span>
<span class="co">#&gt; You are not on linux TSD.</span>
<span class="co">#&gt;  Some functions from this package may not work as intended.FALSE</span></code></pre></div>
<p>Currently, nettskjema data sent to TSD are stored on <code>durable/nettskjema-submissions/XXX/</code> where each nettskjema har its own folder with the nettskjema id (that can be found in the URL of the nettskjema in the nettskjema portal). All Nettskjema that are connected to our TSD project send data to this spot, with one file per response, in an encrypted file in both json and csv format.</p>
<p>All answers to nettskjema can be found immedately in the Nettquick application within TSD (found under the main TULS page within TSD), and as such, quick inspection of incoming data should be done there. The remaining Nettskjema pipeline is more elaborate, and only runs ever few hours.</p>
<div class="section level2">
<h2 id="pipeline-in-short">Pipeline in short<a class="anchor" aria-label="anchor" href="#pipeline-in-short"></a>
</h2>
<p>At its core, the single function <code><a href="../reference/nettskjema_tsd_organise_all_forms.html">nettskjema_tsd_organise_all_forms()</a></code> starts and sets up the entire pipeline for you. There are several options to specify custom output locations, rerunning all files again etc, but these can be checked out in the function documentation.</p>
<ul>
<li>Single response data come in encrypted to TSD
<ul>
<li><code>durable/nettskjema-submissions/XXXX</code></li>
</ul>
</li>
<li>Files are copied to a new safe location
<ul>
<li>
<code>durable/nettskjema-submissions/cleaned</code> by default</li>
<li>custom path can be specified</li>
</ul>
</li>
<li>Data are decrypted</li>
<li>Single responses are combined into larger data sets
<ul>
<li>creates files with names like</li>
<li>
<code>form-xxxxx.csv</code> (data source is incoming csv files)</li>
<li>
<code>form-xxxxx-json.csv</code> (data source is incoming json files)</li>
</ul>
</li>
</ul>
<p>And optional bit can be run for applying edits to data values that have been entered incorrectly, while still retaining the original raw data. We do not recommend ever directly changing raw data, but rather use the editing pipeline provided to keep raw data intact, have a log of changes needed and the reasons for these, and have a working clean data set.</p>
</div>
<div class="section level2">
<h2 id="data-location">Data location<a class="anchor" aria-label="anchor" href="#data-location"></a>
</h2>
<p>The data are first copied over to safe new space, where we can more easily store the data in the way we want, and continue working on them. The incoming data folder is locked in such a way that we are only allowed to copy data out of the folder, not work there in any way.</p>
<p>The new data location is by default the same spot as the incoming data, <code>durable/nettskjema-submissions/cleaned</code> Here, just like in the raw folder, each nettskjema has its own folder using the nettskjema ID.</p>
<pre><code>-- 177322
    -- attachments/
    -- edits-177322.json
    -- form-177322.csv
    -- form-177322-json.csv
    -- form-177322-json-wids.csv
    -- form-177322-json-wids-ed.csv
    -- submissions/
         -- decrypted/
|    -- form-177322-2020-01-31-18-14-32.json
|    -- form-177322-2020-02-23-13-44-01.json
|    -- form-177322-2020-02-24-10-32-22.json
         -- encrypted/
|    -- form-177322-2020-01-31-18-14-32.json.asc
|    -- form-177322-2020-02-23-13-44-01.json.asc
|    -- form-177322-2020-02-24-10-32-22.json.asc</code></pre>
<p>The submission’s folder contains all single file submissions (answers) to the nettskjema. The encrypted are exactly as they are when they enter TSD, and the decrypted are the same files but decrypted so they may be read by users. Some nettskjema might also have attachment folders, which should contain all the attachments that might come with a nettskjema (if the form has the option to add attachments).</p>
</div>
<div class="section level2">
<h2 id="data-decryption">Data decryption<a class="anchor" aria-label="anchor" href="#data-decryption"></a>
</h2>
<p>Data are encrypted and decrypted with gpg.</p>
<p>The data that are encrypted are:</p>
<ul>
<li>submissions as json data</li>
<li>submissions as csv data</li>
<li>form meta data (resent every time there is a change in the Nettskjema form)</li>
</ul>
</div>
<div class="section level2">
<h2 id="data-combining">Data combining<a class="anchor" aria-label="anchor" href="#data-combining"></a>
</h2>
<p>The submission data are combined into data sets for each nettskjema, using both the jsons and csv. The data sources are a little different, which is why we create files from both. Generally, combining data from jsons are more robust than combining data from the csv sources, because the json files do not have issues with possible column mis-matches.</p>
</div>
<div class="section level2">
<h2 id="data-editing">Data editing<a class="anchor" aria-label="anchor" href="#data-editing"></a>
</h2>
<p>There are also options for creating edited versions of the data, in case there are incorrectly submitted values to the nettskjema data. These edits are stored as json files, specifying which data should be edited in the combined data. Edit files are named in the form <code>edits-XXXX.json</code> where <code>XXXX</code> is the nettskjema form id, and is stored in the same location as the <code>form-xxxx.csv</code> files. The edit jsons are organised after submission ids, which is the unique identifier of ANY nettskjema submission.</p>
<pre><code>{
   "889922": {
       "data": {
          "sex": {
             "value": "female",
             "comment": "incorrectly punched by RA"
          },
          "cvlt_a_total": {
             "value": "45",
             "comment": "incorrectly calculated"
         }
     }
  },
  "872635":{
      "data": {},
      "comment": "double punched"
  }
}</code></pre>
<p>In the case above, the first submission has two variables that were entered incorrectly. The <code>sex</code> should be female, and <code>cvlt_a_total</code> should be 45. Each of these has their own comments on why the change is needed. The second submission has been entered by mistake, and so should be deleted in its entirety.</p>
<p>This way we can keep easy track of all edits made to the nettskjema data for posterity.</p>
<p>Edits can be applied to all nettskjema data with a single command if needed:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/nettskjema_tsd_apply_edits_all.html">nettskjema_tsd_apply_edits_all</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This will create new combined files for the form with the ending <code>-ed</code>, so you can always preserve the intact raw data, but also have a working cleaned data set.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Athanasia Mo Mowinckel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
